<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cooper Olney">
<meta name="author" content="Ivan Ramler">
<meta name="dcterms.date" content="2025-07-10">
<meta name="description" content="Exploring wingspan and performance in the NBA by cleaning, merging and analyzing datasets.">

<title>NBA Wingspan &amp; Performance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">NBA Wingspan &amp; Performance</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Webscraping</div>
    <div class="quarto-category">Data Visualization</div>
    <div class="quarto-category">Data Wrangling</div>
    <div class="quarto-category">Joining / Merging</div>
  </div>
  </div>

<div>
  <div class="description">
    Exploring wingspan and performance in the NBA by cleaning, merging and analyzing datasets.
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Cooper Olney </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            St.&nbsp;Lawrence University
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Ivan Ramler <a href="mailto:iramler@stlawu.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            St.&nbsp;Lawrence University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 10, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="module" class="level2">
<h2 class="anchored" data-anchor-id="module">Module</h2>
<p>Please note that these material have not yet completed the required pedagogical and industry peer-reviews to become a published module on the SCORE Network. However, instructors are still welcome to use these materials if they are so inclined.</p>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>The National Basketball Association (NBA) is a professional basketball league featuring the best players from around the world. In the modern NBA, player evaluation has gone far beyond just points. Physical attributes like height, <a href="https://www.nba.com/knicks/videos/how-to-measure-your-wingspan" target="_blank">wingspan</a> and reach are increasingly used by teams to gain a competitive edge. These measurements not only influence how players are scouted and drafted, but also how they’re expected to perform on the court.</p>
<p>One particularly interesting metric is wingspan advantage which is the difference between a player’s wingspan and their height (wingspan - height). A larger wingspan relative to height is often considered beneficial for defense, rebounding, and shot-blocking. However, longer arms can also affect shooting mechanics, sometimes offering an edge by helping players shoot over defenders, but also potentially making it harder to develop a consistent shooting form, but does this actually show up in the data?</p>
<p>In this worksheet, you’ll explore how physical traits like wingspan advantage relate to on-court performance. You’ll work with real NBA data to practice essential skills such as cleaning and joining datasets, as well as visualizing relationships. By the end, you’ll use your cleaned and combined datasets to look for meaningful patterns between a player’s wingspan advantage and their statistical output.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Activity Length">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Activity Length
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This could bew suitable of an out of class activity or one that spans more than one class period.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Learning Objectives">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Learning Objectives
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>By the end of this activity, you will be able to:</p>
<ol type="1">
<li><p>Clean and transform raw and messy data into a structured and analysis ready format.</p></li>
<li><p>Combine multiple datasets, including resolving issues like inconsistent naming.</p></li>
<li><p>Explore relationships between variables and communicate findings using visualizations.</p></li>
<li><p>(Optional) Use web scraping tools to gather additional data from an online source.</p></li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Methods">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Methods
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Technology Requirement:</strong></p>
<p>This activity requires the use of <code>R</code> with familiarity in <code>Quarto</code> documents and several <code>tidyverse</code> packages including <code>dplyr</code>, <code>tidyr</code>, <code>readr</code> and <code>stringr</code>. Students will also work with the <code>janitor</code> and <code>rvest</code> packages to perform webs scraping and clean raw datasets due to data inconsistencies.</p>
</div>
</div>
</div>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>The <code>nba_wingspan_2025.csv</code> dataset contains 499 rows and 4 columns. Each row represents a NBA player from the 2024-25 season. <strong>Note</strong> this dataset is partially cleaned from the data found at craftednba.com.</p>
<p>Download Data: <a href="nba_wingspan_2025.csv" target="_blank">nba_wingspan_2025.csv</a></p>
<details>
<summary>
<b>Variable Descriptions</b>
</summary>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>name</td>
<td>Full name of NBA player, with team abbreviation and primary position</td>
</tr>
<tr class="even">
<td>height</td>
<td>Player’s height in feet &amp; inches format</td>
</tr>
<tr class="odd">
<td>wingspan</td>
<td>Player’s wingspan in feet &amp; inches format</td>
</tr>
<tr class="even">
<td>wingspan_advantage</td>
<td>Difference between wingspan and height in inches (wingspan - height)</td>
</tr>
</tbody>
</table>
</details>
<p>The <code>nba_team_abbreviations.csv</code> dataset contains the abbreviations and full names of the 30 NBA (National Basketball Association) teams.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>team_name</td>
<td>Full name of the NBA team</td>
</tr>
<tr class="even">
<td>team</td>
<td>Standard 3-letter abbreviation for the NBA team</td>
</tr>
</tbody>
</table>
<section id="additional-data-for-version-without-web-scraping" class="level4">
<h4 class="anchored" data-anchor-id="additional-data-for-version-without-web-scraping">Additional Data For Version Without Web Scraping</h4>
<p>The <code>nba_per100possessions_2025.csv</code> dataset contains 736 rows and 14 columns. Each row represents a NBA player from the 2024-25 season. <strong>Note</strong> this dataset contains duplicates because of players switching teams midseason. For example, Luka Dončić will have 3 total rows for his stats with DAL, LAL and his total 2024-25 season stats.</p>
<p>Download Data: <a href="nba_per100possessions_2025.csv" target="_blank">nba_per100possessions_2025.csv</a></p>
<details>
<summary>
<b>Variable Descriptions</b>
</summary>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 89%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>player</td>
<td>Full name of NBA player</td>
</tr>
<tr class="even">
<td>g</td>
<td>Games played during the 2024-25 season</td>
</tr>
<tr class="odd">
<td>mp</td>
<td>Minutes played during the 2024-25 season</td>
</tr>
<tr class="even">
<td>pts</td>
<td>Points scored per 100 possessions</td>
</tr>
<tr class="odd">
<td>orb</td>
<td>Offensive rebounds per 100 possessions</td>
</tr>
<tr class="even">
<td>drb</td>
<td>Defensive rebounds per 100 possessions</td>
</tr>
<tr class="odd">
<td>trb</td>
<td>Total rebounds per 100 possessions</td>
</tr>
<tr class="even">
<td>ast</td>
<td>Assists per 100 possessions</td>
</tr>
<tr class="odd">
<td>stl</td>
<td>Steals per 100 possessions</td>
</tr>
<tr class="even">
<td>blk</td>
<td>Blocks per 100 possessions</td>
</tr>
<tr class="odd">
<td>o_rtg</td>
<td>Offensive Rating: An estimate of points produced per 100 possessions</td>
</tr>
<tr class="even">
<td>d_rtg</td>
<td>Defensive Rating: An estimate of points allowed per 100 possessions</td>
</tr>
<tr class="odd">
<td>e_fg_percent</td>
<td>Effective field goal percentage: Adjusts percentage for the fact that a 3pt field goal is worth more than a 2pt field goal</td>
</tr>
<tr class="even">
<td>ft_percent</td>
<td>Free throw percentage</td>
</tr>
</tbody>
</table>
</details>
<p>The <code>nba_shooting_2025</code> data contains 737 rows and 9 columns. Each row represents a NBA player from the 2024-25 season. <strong>Note</strong> this dataset contains duplicates because of players switching teams midseason. For example, Luka Dončić will have 3 total rows for his stats with DAL, LAL and his total 2024-25 season stats.</p>
<p>Download Data: <a href="nba_shooting_2025.csv" target="_blank">nba_shooting_2025.csv</a></p>
<details>
<summary>
<b>Variable Descriptions</b>
</summary>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>player</td>
<td>Full name of NBA player</td>
</tr>
<tr class="even">
<td>g</td>
<td>Games played during the 2024-25 season</td>
</tr>
<tr class="odd">
<td>fg_percent</td>
<td>Field goal percentage</td>
</tr>
<tr class="even">
<td>avg_dist_of_fg</td>
<td>Average distance (in feet) of field goal attempts</td>
</tr>
<tr class="odd">
<td>2pt_rate</td>
<td>Proportion of field goal attempts that are 2 point attempts</td>
</tr>
<tr class="even">
<td>3pt_rate</td>
<td>Proportion of field goal attempts that are 3 point attempts</td>
</tr>
<tr class="odd">
<td>2pt_percent</td>
<td>Make proportion on 2 point attempts</td>
</tr>
<tr class="even">
<td>3pt_percent</td>
<td>Make proportion on 3 point attempts</td>
</tr>
<tr class="odd">
<td>dunk_rate</td>
<td>Proportion of field goal attempts that are dunks</td>
</tr>
</tbody>
</table>
</details>
</section>
<section id="data-sources" class="level4">
<h4 class="anchored" data-anchor-id="data-sources">Data Sources</h4>
<p><a href="https://craftednba.com/player-traits/length" target="_blank">https://craftednba.com/player-traits/length</a></p>
<p><a href="https://www.basketball-reference.com/leagues/NBA_2025_per_poss.html" target="_blank">https://www.basketball-reference.com/leagues/NBA_2025_per_poss.html</a></p>
<p><a href="https://www.basketball-reference.com/leagues/NBA_2025_shooting.html" target="_blank">https://www.basketball-reference.com/leagues/NBA_2025_shooting.html</a></p>
</section>
</section>
<section id="materials" class="level3">
<h3 class="anchored" data-anchor-id="materials">Materials</h3>
<p><strong>Version With Web Scraping</strong></p>
<ul>
<li><p><a href="nba_wingspans_worksheet.qmd">Class handout</a></p></li>
<li><p>Solutions:</p>
<ul>
<li><a href="nba_wingspans_solutions.qmd">Quarto with visible R code</a></li>
<li><a href="nba_wingspans_solutions.html">HTML with hideable R code</a></li>
</ul></li>
</ul>
<p><strong>Version Without Web Scraping</strong></p>
<ul>
<li><p><a href="nba_wingspans_solutions_no_webscraping.qmd">Class handout</a></p></li>
<li><p>Solutions:</p>
<ul>
<li><a href="nba_wingspans_solutions_no_webscraping.qmd">Quarto with visible R code</a></li>
<li><a href="nba_wingspans_solutions_no_webscraping.html">HTML with hideable R code</a></li>
</ul></li>
</ul>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Conclusion">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Conclusion
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Through this module, you explored how physical attributes, specifically wingspan and wingspan advantage might relate to on-court performance in the NBA. By cleaning the combining data from multiple sources, you’ve created a comprehensive dataset that allowed for deeper exploration of relationships between physical characteristics and basketball statistics.</p>
<p>With your final combined dataset, you were able to generate visualizations to investigate potential connections, such as whether players with longer wingspan advantages tend to have a larger defensive impact. These kinds of relationships can provide use insights for analysts, scouts and even fans trying to understand the value of certain physical traits.</p>
<p>This activity underscores the value of data wrangling, merging and visualization and sets the stage for more advanced analysis in the future. Whether that’s building predictive models, exploring important relationships, or applying machine learning techniques to sports data.</p>
</div>
</div>
</div>
</section>
<section id="additional-reading" class="level3">
<h3 class="anchored" data-anchor-id="additional-reading">Additional Reading</h3>
<ul>
<li><ul>
<li>Kaazempur-Mofrad, A. R. (2022, December). <a href="https://sportrxiv.org/index.php/server/preprint/view/238"><em>Basketball players’ long wingspan enhances defensive upside but hinders shooting capabilities: A statistical inquiry of the effect of NBA player wingspans on shooting accuracy and defensive impact</em></a> (Preprint). <em>SportRxiv</em>. https://doi.org/10.51224/SRXIV.238</li>
</ul></li>
<li><p><a href="https://www.wsj.com/articles/the-freakish-advantage-of-nba-all-stars-1455224954" target="_blank">The Freakish Advantage of NBA All-Stars - The Wall Street Journal</a> (Subscription required)</p></li>
<li><p><a href="https://www.thesportster.com/current-nba-players-with-largest-longest-widest-wingspans/" target="_blank">17 Current NBA Players With The Largest Wingspans, Ranked By Length - TheSportster</a></p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>